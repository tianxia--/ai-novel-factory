# Memory Update Agent

## 功能定义
自动扫描新章节内容，提取并更新记忆库相关信息。

## 执行流程

```
┌─────────────────────────────────────────────────────────┐
│                    Memory Update                         │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  1. 读取目标章节                                         │
│     └─ production/chapters/第X章_*.md                   │
│                                                          │
│  2. 提取关键信息                                         │
│     ├─ 新增设定                                          │
│     ├─ 人物状态变化                                      │
│     ├─ 新伏笔                                            │
│     ├─ 伏笔回收                                          │
│     └─ 时间线事件                                        │
│                                                          │
│  3. 一致性校验                                           │
│     ├─ 对比 canon.md                                     │
│     ├─ 对比 world_rules.md                               │
│     └─ 检查冲突                                          │
│                                                          │
│  4. 更新记忆文件                                         │
│     ├─ 更新 canon.md（如有核心设定）                     │
│     ├─ 更新 characters_evolution.md                      │
│     └─ 更新 foreshadowing.md                             │
│                                                          │
│  5. 生成更新报告                                         │
│     └─ state/memory_update_[章节].md                    │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

## 信息提取规则

### 新增设定识别
- 出现新的力量/能力描述
- 出现新的世界观规则
- 出现重要历史事件

### 人物变化识别
- 能力等级变化
- 重要物品获取/失去
- 心理状态转变
- 人物关系变化

### 伏笔识别
- 明显的悬念设置
- 未解释的异常
- 预示性描述
- 回收之前的伏笔

## 输入要求
- 章节编号或章节文件路径

## 输出格式
更新记忆文件 + 生成报告：

```markdown
# 记忆更新报告 - 第X章

## 提取信息汇总

### 新增设定
1. [设定内容]
   - 类型：力量/规则/历史
   - 重要性：高/中/低

### 人物状态变更
| 角色 | 变更类型 | 详情 |
|-----|---------|-----|
| ... | ... | ... |

### 伏笔操作
- 新增：[内容]
- 回收：[内容]

### 时间线事件
- [事件描述]

## 一致性校验结果
- 与 canon 冲突：无/有（详情）
- 与 world_rules 冲突：无/有（详情）

## 更新的文件
- [ ] canon.md
- [ ] characters_evolution.md
- [ ] foreshadowing.md
- [ ] world_rules.md
```

## 调用方式
```
@memory_update [章节编号]
```

## 自动触发条件
- 每章生成后自动运行
- 用户手动请求

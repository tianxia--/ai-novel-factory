# Consistency Check Agent

## 功能定义
全面检查章节与记忆库、设定的不一致问题，防止长篇崩盘。

## 检查维度

### 1. 设定一致性
- [ ] 力量体系是否越界
- [ ] 世界规则是否违背
- [ ] 时间线是否正确
- [ ] 地理设定是否正确

### 2. 人物一致性
- [ ] 行为是否符合人设
- [ ] 能力是否合理
- [ ] 关系是否正确
- [ ] 称呼是否统一

### 3. 剧情一致性
- [ ] 事件逻辑是否自洽
- [ ] 伏笔是否遗漏
- [ ] 承诺是否兑现
- [ ] 冲突是否合理

### 4. 细节一致性
- [ ] 人物外貌描述
- [ ] 物品属性
- [ ] 场景细节
- [ ] 时间表述

## 执行流程

```
┌─────────────────────────────────────────────────────────┐
│                 Consistency Check                        │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  1. 加载目标章节                                         │
│                                                          │
│  2. 加载所有记忆库文件                                   │
│     ├─ canon.md                                         │
│     ├─ world_rules.md                                   │
│     ├─ characters_evolution.md                          │
│     └─ foreshadowing.md                                 │
│                                                          │
│  3. 逐项检查                                             │
│     ├─ 设定比对                                         │
│     ├─ 人物状态比对                                     │
│     ├─ 事件逻辑校验                                     │
│     └─ 细节一致性检查                                   │
│                                                          │
│  4. 生成问题清单                                         │
│     ├─ 严重问题（阻断性）                               │
│     ├─ 一般问题（建议修复）                             │
│     └─ 潜在风险（需关注）                               │
│                                                          │
│  5. 输出报告                                             │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

## 输入要求
- 检查范围：单章/多章/整卷
- 检查深度：快速/标准/深度

## 输出格式
输出到: `state/consistency_check_[范围].md`

```markdown
# 一致性检查报告

## 检查范围
- 章节：第X章 - 第Y章
- 检查时间：YYYY-MM-DD
- 检查深度：标准

## 问题汇总

### 严重问题 🔴
必须修复，否则影响后续创作

| 章节 | 问题类型 | 详情 | 位置 | 修复建议 |
|-----|---------|-----|-----|---------|
| X | 设定冲突 | ... | 第N段 | ... |

### 一般问题 🟡
建议修复，提升作品质量

| 章节 | 问题类型 | 详情 | 位置 | 修复建议 |
|-----|---------|-----|-----|---------|
| X | 细节不一致 | ... | 第N段 | ... |

### 潜在风险 🟢
当前无问题，但需持续关注

| 风险类型 | 详情 | 监控建议 |
|---------|-----|---------|
| ... | ... | ... |

## 记忆库更新建议
[需要更新到记忆库的内容]

## 通过率统计
- 设定一致性：X/X
- 人物一致性：X/X
- 剧情一致性：X/X
- 细节一致性：X/X
- **总体通过率：XX%**
```

## 调用方式
```
@consistency_check [章节范围]
```

## 使用建议
- 每章完成后快速检查
- 每5章标准检查
- 每卷结束深度检查
- 发现问题时即时检查
